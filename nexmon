sudo apt-get update 
sudo apt-get upgrade
sudo apt install git libgmp3-dev gawk qpdf bison flex make automake autocong raspberrypi-kernel-headers
sudo git clone https://github.com/seemoo-lab/nexmon.git /usr/local/src
cd /usr/local/src/nexmon && sudo -s

# Check if /usr/lib/arm-linux-gnueabihf/libisl.so.10 exists,
ls /usr/lib/arm-linux-gnueabihf/libisl.so.*
# if there is no libisl.so.10 in the list, compile it from source:
cd buildtools/isl-0.10
./configure
make
make install
ln -s /usr/local/lib/libisl.so /usr/lib/arm-linux-gnueabihf/libisl.so.10

# Setup the build environment:
cd /usr/local/src/nexmon/ && source setup_env.sh
make

cd patches/bcm43430a1/7_45_41_46/nexmon/ && make
make backup-firmware
mkdir /lib/modules/Re4son+/build

# Install the patched firmware on your RPI0W:
make install-firmware

# Install nexutil: 
cd /usr/local/src/nexmon/utilities/nexutil/
make
make install

# Optional: 
# apt-get remove wpasupplicant

# To connect to regular access points you have to execute
nexutil -m0 

# Using the Monitor Mode patch
iw phy phy1 interface add mon0 type monitor
iw dev wlan0 info
ifconfig mon0 up

# At this point, monitor mode is active. 
# There is no need to call airmon-ng.
# The interface already set the Radiotap header, therefore, tools like tcpdump or airodump-ng can be used out of the box:
tcpdump -i mon0

# To make the RPI3 load the modified driver after reboot: 
# Find the path of the default driver at reboot:
modinfo brcmfmac 
#the first line should be the full path

# Backup the original driver:
mv “<PATH TO THE DRIVER>/brcmfmac.ko” “<PATH TO THE DRIVER>/brcmfmac.ko.orig”

# Copy the modified driver:
cp /usr/local/src/nexmon/patches/bcm43430a1/7_45_41_46/nexmon/brcmfmac_kernel49/brcmfmac.ko “<PATH TO THE DRIVER>/”

# Probe all modules and generate new dependency:
depmod -a

# The new driver should be loaded by default after reboot: 
reboot 

# It is possible to connect to an access point or run your own access point in parallel 
# to the monitor mode interface on the wlan0 interface.

# Optional 
# Nexmon Drivers
# The nexmon drivers enable monitor mode and frame injection for the build in wifi chips of the Pi3 and Pi0W. 
# The re4son kernel includes the compiled nexmon drivers and firmware with -m6 and -m7 support. 
# To install, reboot after installing a new kernel and run:

cd /usr/local/src/re4son-kernel_4*
./install.sh -x

# If you have any problems with the drivers and wish to rollback to to original ones, just run:
cd /usr/local/src/re4son-kernel_4*
./install.sh -o

# Head over to the nexmon project for details: 
# https://github.com/seemoo-lab/nexmon
